import{_ as se}from"./rafikey-hi-CDOTn0v9.js";import{f as te,k as ae,i as g,a3 as re,a1 as y,q as le,a4 as ie,n as ne,p as T,c as u,g as s,d as m,B as w,u as n,a as f,C as x,w as _,r as oe,G as v,N as C,h as j,j as de,J as ue,o as d,b as $,y as L}from"./index-DmnJlZDj.js";import{_ as U,H as ce}from"./index-DcTmDbD8.js";import{m as B,a as p}from"./moment-BHTDC-Ci.js";import{_ as G,a as A,b as Y}from"./ErrorScreen.vue_vue_type_script_setup_true_lang-Dg1emoJk.js";import{a as ge,i as me}from"./rafikey-icon-dark-Bxp0jwbr.js";const pe={class:"min-h-screen dark:bg-lightgray w-full"},fe={class:"lg:w-9/12 w-11/12 mx-auto py-10 hidden md:block"},xe={key:0,class:"space-y-8 pt-12"},he={class:"space-y-1"},ye={key:0,class:"text-extra-extra-large-1 text-stone-400"},be={key:1,class:"border border-casablanca-300 lg:py-4 px-2 py-1 rounded-lg w-full lg:w-3/4 xl:w-1/2"},ke={class:"dark:text-white lg:text-lg text-sm"},we={class:"py-10 h-full"},ve={key:0},Ie={key:1,ref:"userInputContainerHeightRef",class:"sticky w-full bottom-0 bg-white dark:bg-lightgray"},_e={class:""},$e={class:"px-4 w-full md:hidden block"},Se={key:0},Re={class:"flex items-center justify-between"},Ce={class:"w-32"},Ee=["src"],qe={class:"space-y-12"},He={class:"space-y-4"},Me={class:"border border-casablanca-300 px-2 py-1 rounded-lg w-full"},Te={class:"dark:text-white text-sm"},je={class:""},Le={class:"space-y-2 p-5"},Ue=["onClick"],Be={class:"material-icons-outlined dark:text-white"},Ge={class:"dark:text-white text-small"},Ae={key:1},Ye={class:"cursor-pointer flex justify-between sticky top-0 dark:bg-lightgray bg-white z-10 p-4 backdrop-blur"},Ne={class:"py-12 h-full"},De={key:0},Ve={key:0,ref:"userInputContainerHeightRef",class:"sticky w-full bottom-0 bg-white dark:bg-lightgray"},ze={class:""},Ke=te({__name:"ChatPage",props:{sessionId:{}},setup(N){const t=ae(),E=g(!1),q=de(),b=B();re("(max-width: 767px)");const D=g(""),V={link({href:a,title:e,text:i}){return`<a target="_blank" class="link link-primary" href="${a}" title="${e}">${i}</a>`},table({header:a,rows:e,align:i}){const l=a.map(({text:r,header:c})=>`
      <th class="text-base-content text-large">${p.parseInline(r)}</th>
    `).join(`
`),o=e.map(r=>`
      <tr>${r.map(({text:c,header:Z})=>`
        <td class="text-base-content text-large">${p.parseInline(c)}</td>
      `).join(`
`)}</tr>
    `).join(`
`);return`
   <div class="bg-base-100 p-2.5 rounded-xl shadow-lg shadow-base-200 my-5">
    <div class="overflow-x-auto py-4">
        <table class="table table-sm text-large table-zebra border">
        <thead>
            ${l}
        </thead>
        <tbody>
            ${o}
        </tbody>
    </table>
    </div>
    </div>
  `},code({text:a,lang:e,codeBlockStyle:i,escaped:l}){return e?`
  <div class="p-2 flex w-full">
       <pre class="w-full"><div class="mockup-code bg-neutral-800 my-3 relative shadow-xl w-full overflow-auto"><div class="px-4 flex-1 overflow-auto h-full w-full"><code class="language-${e}">${ce.highlight(a,{language:e,ignoreIllegals:!0}).value}</code></div></div></pre>
  </div>
    `:`
  <div class="p-3 flex w-full">
    <div class="mockup-code bg-base-100 my-2.5 w-full overflow-auto max-w-full"><pre class="w-full text-sm md:text-md text-base-content"><div class="px-4 flex-1 overflow-auto h-full w-full"><code>${a}</code></div></pre></div>
  </div>
  `},list({ordered:a,start:e,loose:i,items:l}){const o=l.map(({task:r,checked:c,loose:Z,text:ee})=>`
      <li class="text-base-accent text-large">${p.parseInline(ee)}</li>
      `).join(`
`);return a?e?`
         <div class="my-2 py-2 mx-3">
            <ol start="${e}" class="list-decimal list-outside mx-5 space-y-0.5 md:space-y-1 lg:space-y-1.5">${o}</ol>
         </div>
      `:`
         <div class="my-2 py-2 mx-3">
            <ol class="list-decimal mx-5 list-outside space-y-0.5 md:space-y-1 lg:space-y-1.5">${o}</ol>
         </div>
    `:`
         <div class="my-2 py-2 mx-3">
            <ul class="list-disc list-outside mx-5 space-y-0.5 md:space-y-1 lg:space-y-1.5">${o}</ul>
         </div>
    `},listitem({task:a,checked:e,loose:i,text:l}){return`
    <li class="text-base-accent text-small">${p.parseInline(l)}</li>
  `},paragraph({text:a,pre:e}){return`
    <p class="text-base-accent leading-relaxed text-small">${p.parseInline(a)}</p>
  `},heading({text:a,depth:e}){let i="dark:text-white text-large my-2";switch(e){case 1:i="dark:text-white text-extra-large my-2";break;case 2:i="dark:text-white  text-large my-1.5 ";break;case 3:i="dark:text-white  text-small my-1.5";break;case 4:i="dark:text-white  text-extra-small  my-1";break;case 5:i="dark:text-white text-extra-extra-small my-1";break;case 6:i="dark:text-white   text-extra-extra-small-2  my-0.5";break}return`
    <h${e} class="${i} font-semibold text-base-accent dark:text-white">${p.parseInline(a)}</h${e}>
  `},hr(){return`
    <hr class="my-4 border-neutral-200"/>
  `},blockquote({text:a}){return`
    <blockquote class="my-4 border-l-4 border-neutral-200 pl-4">${a}</blockquote>
  `},image({href:a,title:e,text:i}){return`
    <img src="${a}" alt="${i}" title="${e}" class="w-full"/>
  `},strong({text:a}){return`
    <strong class="dark:text-white font-semi-bold  my-2.5 text-small">${a}</strong>
  `},codespan({text:a}){return`
    <code class="font-semi-bold my-1">&acute;${a}&acute;</code>
  `},em({text:a}){return`
    <em class="font-light my-1 text-small">${a}</em>
  `},del({text:a}){return`
    <del class="font-poppins-light my-1 text-small">${a}</del>
  `},text({text:a,type:e}){return e==="text"?`
      <span class="text-small">${a}</span>
    `:e==="escape"?`
      <span class="text-small">${a}</span>
    `:`
      <span class="text-small">${a}</span>
    `}};p.use({renderer:V,breaks:!0,gfm:!0,useNewRenderer:!0});const I=a=>{if(t.regenerateResponse)t.isGeneratingResponse=!0,t.sendMessageToRafikeyChatbot({message:a,sessionId:t.getSessionId}).then(e=>{if((e==null?void 0:e.result)==="ok"){const i=t.conversation.filter(o=>!o.isUser),l=i[i.length-1];l&&(l.message=e.data)}else t.setStreamError({hasError:!0,errorMessage:e==null?void 0:e.data,isLoggedIn:!0})}).catch(e=>{console.log("error catch",e),t.setStreamError({hasError:!0,errorMessage:"An error occurred, please try again later.",isLoggedIn:!0})}).finally(()=>{t.isGeneratingResponse=!1,t.setRegenerateResponse(!1)});else{D.value=a;const e=g({message:a,isUser:!0,uniqueId:y.uniqueId("user-")});R(),t.conversation.push(e.value);const i=g({message:"",isUser:!1,isTyping:!0,uniqueId:y.uniqueId("rafikey-")});console.log("Here in the handler "),setTimeout(()=>{t.conversation.push(i.value)},500),t.isGeneratingResponse=!0,t.sendMessageToRafikeyChatbotAnonymous({message:a,sessionId:t.getSessionId}).then(l=>{if((l==null?void 0:l.result)==="ok"){const o=t.conversation.filter(c=>!c.isUser),r=o[o.length-1];r&&(r.message=l==null?void 0:l.data)}else t.setStreamError({hasError:!0,errorMessage:l==null?void 0:l.data,isLoggedIn:!0})}).catch(l=>{t.setStreamError({hasError:!0,errorMessage:"An error occurred while generating the response. Please try again later.",isLoggedIn:!0})}).finally(()=>{t.isGeneratingResponse=!1,i.value.isTyping=!1})}},z=a=>{const e=B.utc(a).local();return b.isSame(e,"day")?e.format("[Today] h:mm A"):b.clone().subtract(1,"days").isSame(e,"day")?e.format("[Yesterday] h:mm A"):b.clone().subtract(1,"weeks").isBefore(e,"day")?e.format("dddd h:mm A"):b.clone().subtract(1,"weeks").isAfter(e)?e.format("[Last]dddd h:mm A"):b.clone().subtract(1,"years").isBefore(e)?e.format("MMMM D, dddd"):e.format("YYYY")},H=g({message:"",isUser:!0,uniqueId:y.uniqueId("user-"),timestamp:""}),S=g({message:"",isUser:!1,isTyping:!0,uniqueId:y.uniqueId("rafikey-"),timestamp:""}),P=g(!0),O=a=>{t.conversation=[],t.getChatHistory(a).then(e=>{(e==null?void 0:e.result)=="ok"&&e.data.sort((l,o)=>new Date(l.timestamp).getTime()-new Date(o.timestamp).getTime()).forEach(l=>{const o=z(l.timestamp);H.value={message:l.user_message,isUser:!0,uniqueId:y.uniqueId("user-"),timestamp:o},t.conversation.push(H.value),S.value={message:l.bot_response,isUser:!1,isTyping:!1,uniqueId:y.uniqueId("rafikey-"),timestamp:o},t.conversation.push(S.value)})}).catch(e=>{console.error("Error fetching chat history",e)}).finally(()=>{t.isGeneratingResponse=!1,S.value.isTyping=!1,P.value=!1})},M=g(!1),k=N;le(()=>{setTimeout(()=>{M.value=!0},3e3),k.sessionId?(h.value=!0,O(k.sessionId)):t.setSessionId(ie())});const F=()=>{q.push({name:"login"})},Q=()=>{q.push({name:"welcome-page"})},J=ne(()=>t.isDarkMode?ge:me),h=g(!1),W=()=>{h.value=!0},R=()=>{ue(()=>{const a=document.getElementById("userInputPlaceholder-small");a&&(console.log("Scrolling small"),a.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}))})};T(()=>t.conversation||t.isStreamError.hasError,()=>{console.log("Now scrolling!!!"),R()}),T(()=>t.regenerateResponse,a=>{a&&I(t.regenerateUserInput)}),setTimeout(()=>{R()},1e3);const K=[{id:1,question:"How can I know I have STI?",icon:"sms"},{id:2,question:"Best gynecologist?",icon:"sms"},{id:3,question:"How to wear a condom",icon:"sms"}],X=a=>{t.conversation=[],I(a),h.value=!0};return(a,e)=>{var l,o;const i=oe("RouterLink");return d(),u("div",pe,[s("div",fe,[s("div",{class:w(["flex justify-between sticky top-0 bg-opacity-30 white backdrop-blur",[n(t).conversation.length>0?"pt-4":""]])},[e[4]||(e[4]=s("div",null,[s("button",null,[s("span",{class:"dark:text-white text-extra-extra-small"},"Feedback")])],-1)),s("div",{class:"flex items-end gap-2"},[s("div",{class:""},[s("button",{onClick:F,class:"btn btn-sm px-6 py-2 shadow-none border-none bg-black dark:bg-white text-white dark:text-black rounded-lg"},e[1]||(e[1]=[s("span",{class:"text-extra-small"},"Log in",-1)]))]),e[3]||(e[3]=s("span",{class:"text-extra-small dark:text-white"},"or",-1)),s("div",null,[s("button",{onClick:Q,class:"btn btn-sm px-6 py-2 shadow-none bg-white dark:bg-transparent rounded-xl border dark:border-white border-black dark:text-white text-black"},e[2]||(e[2]=[s("span",{class:"text-extra-small"},"Sign up",-1)]))])])],2),n(t).conversation.length<1&&!k.sessionId?(d(),u("div",xe,[s("div",he,[e[10]||(e[10]=s("h2",{class:"text-extra-extra-large-2 font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-azure-radiance-600 to-coral-red-500"}," Hi there ",-1)),M.value?(d(),u("div",be,[e[9]||(e[9]=s("span",{class:"dark:text-white lg:text-lg text-sm"},"Heads up! Your chat is temporary unless you're logged in.",-1)),s("p",ke,[f(i,{to:"/auth/register",class:"text-casablanca-300 lg:text-lg text-sm"},{default:_(()=>e[5]||(e[5]=[x("Create an account ")])),_:1}),e[7]||(e[7]=x(" or ")),f(i,{to:"/auth/login",class:"text-casablanca-300 lg:text-lg text-sm"},{default:_(()=>e[6]||(e[6]=[x("Log in ")])),_:1}),e[8]||(e[8]=x(" to save your conversations and access them anytime. "))])])):(d(),u("p",ye," Let's talk sexual and reproductive health "))]),e[11]||(e[11]=s("div",{class:"flex justify-end"},[s("img",{src:se,alt:"rafikey-image",class:"lg:w-60 w-40"})],-1))])):m("",!0),s("div",we,[s("ul",null,[(d(!0),u(v,null,C(n(t).conversation,(r,c)=>(d(),u(v,{key:c},[r.isUser&&r.message.length>0&&!r.isTyping?(d(),$(A,{"user-message":r.message,"user-name":"You","created-at":r.timestamp||"","is-generating-response":n(t).isGeneratingResponse,key:r.uniqueId},null,8,["user-message","created-at","is-generating-response"])):m("",!0),!r.isUser&&!E.value?(d(),$(Y,{"chatbot-name":"Rafikey","rafikey-chatbot-message":n(p).parse(r.message),"is-typing":!1,"is-copyable":!1,"is-error":!1,"created-at":r.timestamp||"","is-generating-response":n(t).isGeneratingResponse,key:r.uniqueId},null,8,["rafikey-chatbot-message","created-at","is-generating-response"])):m("",!0)],64))),128))]),(l=n(t))!=null&&l.isStreamError.hasError?(d(),u("div",ve,[f(G,{"error-message":n(t).isStreamError.errorMessage,"is-logged-in":n(t).isStreamError.isLoggedIn},null,8,["error-message","is-logged-in"])])):m("",!0)]),n(t).isStreamError.hasError?m("",!0):(d(),u("div",Ie,[s("div",{class:w(["bg-white dark:bg-lightgray backdrop-blur-2xl pb-6",[n(t).conversation.length>0||k.sessionId?"fixed bottom-0 left-4  w-[calc(100vw-2rem)] ":""]])},[s("div",_e,[f(U,{class:w(["mx-auto",[n(t).conversation.length>0||k.sessionId?"w-11/12 lg:w-9/12":"w-full"]]),disabled:!1,"is-generating":n(t).isGeneratingResponse,onUserInput:I,"display-bottom":n(t).conversation.length>0},null,8,["class","is-generating","display-bottom"])])],2)],512))]),s("div",$e,[h.value?(d(),u("div",Ae,[s("div",Ye,[s("div",{class:"flex gap-4 cursor-pointer",onClick:e[0]||(e[0]=r=>h.value=!h.value)},e[21]||(e[21]=[s("span",{class:"material-icons-outlined dark:text-white"},"arrow_back",-1),s("span",{class:"dark:text-white"},"Chatting With Rafikey",-1)])),e[22]||(e[22]=s("div",null,[s("span",{class:"material-icons-outlined dark:text-white"},"more_horiz")],-1))]),s("div",Ne,[s("ul",null,[(d(!0),u(v,null,C(n(t).conversation,(r,c)=>(d(),u(v,{key:c},[r.isUser&&r.message.length>0&&!r.isTyping?(d(),$(A,{"user-message":r.message,"user-name":"You","created-at":r.timestamp||"","is-generating-response":n(t).isGeneratingResponse,key:r.uniqueId},null,8,["user-message","created-at","is-generating-response"])):m("",!0),!r.isUser&&!E.value?(d(),$(Y,{"chatbot-name":"Rafikey","rafikey-chatbot-message":n(p).parse(r.message)||"","is-typing":!1,"is-copyable":!1,"is-error":!1,"created-at":r.timestamp,"is-generating-response":n(t).isGeneratingResponse,key:r.uniqueId},null,8,["rafikey-chatbot-message","created-at","is-generating-response"])):m("",!0)],64))),128))]),(o=n(t))!=null&&o.isStreamError.hasError?(d(),u("div",De,[f(G,{"error-message":n(t).isStreamError.errorMessage,"is-logged-in":n(t).isStreamError.isLoggedIn},null,8,["error-message","is-logged-in"])])):m("",!0)]),n(t).isStreamError.hasError?m("",!0):(d(),u("div",Ve,[s("div",{class:w(["bg-white dark:bg-lightgray backdrop-blur-2xl pb-6 fixed bottom-0",[n(t).conversation.length>0?"left-0 right-0":"left-4 right-4"]])},[s("div",ze,[f(U,{class:w(["mx-auto",[n(t).conversation.length>0?"w-11/12":""]]),disabled:!1,"is-generating":n(t).isGeneratingResponse,onUserInput:I,"display-bottom":n(t).conversation.length>0},null,8,["class","is-generating","display-bottom"])])],2)],512))])):(d(),u("div",Se,[s("div",Re,[s("div",Ce,[s("img",{src:J.value,alt:"rafikey-icon"},null,8,Ee)]),e[12]||(e[12]=s("div",{class:"border dark:border-stone-300 rounded-full flex h-8 w-8 justify-center items-center"},[s("span",{class:"material-icons-outlined dark:text-stone-300 !text-lg"},"settings")],-1))]),s("div",qe,[s("div",{class:"cursor-pointer flex gap-4 pt-8 w-full"},[s("div",{class:"w-full bg-link-water-50 flex flex-col dark:bg-darkgray rounded-xl sm:p-4 p-2 space-y-2",onClick:W},e[13]||(e[13]=[j('<div class="bg-purple-500 rounded-full h-10 w-10 flex justify-center items-center"><span class="material-icons-outlined dark:text-white">sms</span></div><div class="flex justify-between dark:text-white gap-4"><p class="text-small">Chat with Rafikey</p><span class="material-icons-outlined text-sm">arrow_forward</span></div>',2)])),e[14]||(e[14]=j('<div class="w-full bg-link-water-50 dark:bg-darkgray rounded-xl sm:p-4 p-2 space-y-2"><div class="bg-yellow-500 rounded-full h-10 w-10 flex justify-center items-center"><span class="material-icons-outlined dark:text-white">mic_none</span></div><div class="flex dark:text-white gap-4"><p class="text-small">Chat with Rafikey</p><span class="material-icons-outlined text-sm">arrow_forward</span></div></div>',1))]),s("div",He,[s("div",Me,[e[19]||(e[19]=s("span",{class:"dark:text-white text-sm"},"Heads up! Your chat is temporary unless you're logged in.",-1)),s("p",Te,[f(i,{to:"/auth/register",class:"text-casablanca-300 lg:text-lg text-sm"},{default:_(()=>e[15]||(e[15]=[x("Create an account ")])),_:1}),e[17]||(e[17]=x(" or ")),f(i,{to:"/auth/login",class:"text-casablanca-300 text-sm"},{default:_(()=>e[16]||(e[16]=[x("Log in ")])),_:1}),e[18]||(e[18]=x(" to save your conversations and access them anytime. "))])])]),s("div",je,[s("div",Le,[e[20]||(e[20]=s("div",{class:"flex justify-between sm:p-4"},[s("p",{class:"dark:text-white text-extra-large"},"History"),s("span",{class:"text-purple-400 text-small"},"See all")],-1)),(d(),u(v,null,C(K,r=>s("div",{key:r.id},[s("div",{onClick:c=>X(r.question),class:"cursor-pointer flex dark:bg-darkgray bg-link-water-50 rounded-xl sm:p-5 p-3 gap-4"},[s("span",Be,L(r.icon),1),s("p",Ge,L(r.question),1)],8,Ue)])),64))])])])]))]),e[23]||(e[23]=s("div",{id:"userInputPlaceholder-small",class:"pt-20"},null,-1))])}}});export{Ke as default};
